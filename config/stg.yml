# define the domains this service should respond to requests for
# one per line using name: in a sequence under the domain scalar
# use name: as key for each item in sequence
domains:
  - name: "*.stg.nytimes.com"
  - name: "www.stg.nytimes.com"

# these are the default values for backend config keys if not specified
# some are only here for documentation purposes, some you can override
backend_defaults:
  use_ssl: "true" # can override, you must providfe ssl_cert_hostname if true
  port: "443" # can override this, default behaviour is TLS on port 443
  ssl_check_cert: "true" # cannot be overridden, must use this value if TLS enabled
  auto_loadbalance: "false" # cannot be overidden, we cannot use this in this service

# these are the default values for healthcheck config keys if not specified
healthcheck_defaults:
  method: "GET" # healthchecks will use "GET" method unless specified

# define each backend here in sequence under backends scalar
# as well as it's healthcheck like:
#
# backends:
#   - name: "fancyapp"
#     key: "value"
#     healthcheck:
#       host: "fancyapp.nyt.net"
#       key: "value"
#
#   - name: "fanciestapp"
#     key: "value"
#     healthcheck:
#       host: "fanciestapp.nyt.net"
#       key: "value"
#
# each backend must provide a healthcheck for itself!
# Add a blank line between each one for readability.
# Pay attention to the above defined defaults!
# each backend must be named uniquely! (do a find before naming)
# name your backend descriptively for what app it is: don't use "web_app", do use "worldcup_fe"
# each backend AUTOMATICALLY gets a condition attached checking req.http.x-nyt-backend == "backend_name"

# begin backend configuration for this service
backends:
  - name: "adx_static"
    address: "storage.googleapis.com"
    between_bytes_timeout: "5000"
    connect_timeout: "5000"
    first_byte_timeout: "5000"
    ssl_cert_hostname: "storage.googleapis.com"
    ssl_sni_hostname: "storage.googleapis.com"
    healthcheck:
      host: "nyt-adx-static.storage.googleapis.com"
      path: "/healthcheck.txt"
      check_interval: "5000"
      expected_response: "200"
      initial: "2"
      threshold: "3"
      timeout: "2000"
      window: "5"

  - name: "article_fe"
    address: "nyt5-app-article.stg.oma1.nyt.net"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "30000"
    ssl_cert_hostname: "nyt5-app-article.stg.oma1.nyt.net"
    ssl_sni_hostname: "nyt5-app-article.stg.oma1.nyt.net"
    healthcheck:
      host: "nyt5-app-article.stg.oma1.nyt.net"
      path: "/.status"
      check_interval: "20000"
      expected_response: "200"
      initial: "3"
      threshold: "3"
      timeout: "5000"
      window: "4"

  - name: "www_userinfo"
    address: "nyt5-api-userinfo.stg.oma1.nyt.net"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "30000"
    ssl_cert_hostname: "nyt5-api-userinfo.stg.oma1.nyt.net"
    ssl_sni_hostname: "nyt5-api-userinfo.stg.oma1.nyt.net"
    healthcheck:
      host: "nyt5-api-userinfo.stg.oma1.nyt.net"
      path: "/.status"
      check_interval: "20000"
      expected_response: "200"
      initial: "3"
      threshold: "3"
      timeout: "5000"
      window: "4"

  - name: "beta_guides"
    address: "frontend.guides.stg.nyt.net"
    between_bytes_timeout: "5000"
    connect_timeout: "5000"
    first_byte_timeout: "5000"
    ssl_cert_hostname: "frontend.guides.stg.nyt.net"
    ssl_sni_hostname: "frontend.guides.stg.nyt.net"
    healthcheck:
      host: "frontend.guides.stg.nyt.net"
      path: "/api/health"
      check_interval: "20000"
      expected_response: "200"
      initial: "4"
      threshold: "4"
      timeout: "3000"
      window: "5"

  - name: "beta_watching"
    address: "np-watching-stg-public-668029006.us-east-1.elb.amazonaws.com"
    between_bytes_timeout: "5000"
    connect_timeout: "5000"
    first_byte_timeout: "5000"
    port: "80"
    use_ssl: "false"
    healthcheck:
      host: "np-watching-stg-public-668029006.us-east-1.elb.amazonaws.com"
      path: "/api/health"
      check_interval: "5000"
      expected_response: "200"
      initial: "4"
      threshold: "4"
      timeout: "3000"
      window: "5"

  - name: "collection_fe"
    address: "nyt5-app-collection.stg.oma1.nyt.net"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "30000"
    ssl_cert_hostname: "nyt5-app-collection.stg.oma1.nyt.net"
    ssl_sni_hostname: "nyt5-app-collection.stg.oma1.nyt.net"
    healthcheck:
      host: "nyt5-app-collection.stg.oma1.nyt.net"
      path: "/.status"
      check_interval: "20000"
      expected_response: "200"
      initial: "4"
      threshold: "3"
      timeout: "5000"
      window: "4"

  - name: "collections_svc"
    address: "ce-collections-stg.dv.nyt.net"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "30000"
    ssl_cert_hostname: "ce-collections-stg.dv.nyt.net"
    ssl_sni_hostname: "ce-collections-stg.dv.nyt.net"
    healthcheck:
      host: "ce-collections-stg.dv.nyt.net"
      path: "/svc/collections/v1/publish/scoop/www.nytimes.com/section/sports/hockey?limit=0"
      check_interval: "20000"
      expected_response: "200"
      initial: "4"
      threshold: "3"
      timeout: "5000"
      window: "4"

  - name: "add_svc"
    address: "ce-search-add-api-stg.dv.nyt.net"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "30000"
    ssl_cert_hostname: "ce-search-add-api-stg.dv.nyt.net"
    ssl_sni_hostname: "ce-search-add-api-stg.dv.nyt.net"
    healthcheck:
      host: "ce-search-add-api-stg.dv.nyt.net"
      path: "/actuator/health"
      check_interval: "20000"
      expected_response: "200"
      initial: "4"
      threshold: "3"
      timeout: "5000"
      window: "4"

  - name: "content_api"
    address: "origin-content.api.stg.nytimes.com"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "10000"
    ssl_cert_hostname: "origin-content.api.stg.nytimes.com"
    ssl_sni_hostname: "origin-content.api.stg.nytimes.com"
    healthcheck:
      host: "origin-content.api.stg.nytimes.com"
      path: "/version.json"
      check_interval: "5000"
      expected_response: "200"
      initial: "4"
      threshold: "4"
      timeout: "3000"
      window: "5"

  - name: "gae_oembed_content_api"
    address: "nyt-du-dev.appspot.com"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "10000"
    ssl_cert_hostname: "nyt-du-dev.appspot.com"
    ssl_sni_hostname: "nyt-du-dev.appspot.com"
    healthcheck:
      host: "nyt-du-dev.appspot.com"
      path: "/healthcheck"
      check_interval: "60000"
      expected_response: "200"
      initial: "4"
      threshold: "4"
      timeout: "3000"
      window: "5"

  - name: "games_assets"
    address: "storage.googleapis.com"
    between_bytes_timeout: "5000"
    connect_timeout: "5000"
    first_byte_timeout: "5000"
    ssl_cert_hostname: "storage.googleapis.com"
    ssl_sni_hostname: "storage.googleapis.com"
    healthcheck:
      host: "storage.googleapis.com"
      path: "/games-assets/fastly-up.txt"
      check_interval: "20000"
      expected_response: "200"
      initial: "4"
      threshold: "3"
      timeout: "5000"
      window: "4"

  - name: "games_svc"
    address: "nyt-games-dev.appspot.com"
    between_bytes_timeout: "15000"
    connect_timeout: "10000"
    first_byte_timeout: "15000"
    ssl_cert_hostname: "nyt-games-dev.appspot.com"
    ssl_sni_hostname: "nyt-games-dev.appspot.com"
    healthcheck:
      host: "nyt-games-dev.appspot.com"
      path: "/status.txt"
      check_interval: "10000"
      expected_response: "200"
      initial: "5"
      threshold: "3"
      timeout: "10000"
      window: "5"

  - name: "games_web"
    address: "puzzles.dev.nyt.net"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "10000"
    ssl_cert_hostname: "puzzles.dev.nyt.net"
    ssl_sni_hostname: "puzzles.dev.nyt.net"
    healthcheck:
      host: "puzzles.dev.nyt.net"
      path: "/health-web"
      check_interval: "10000"
      expected_response: "200"
      initial: "5"
      threshold: "3"
      timeout: "10000"
      window: "5"

  - name: "games_phoenix"
    address: "phoenix.games.dev.nyt.net"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "10000"
    ssl_cert_hostname: "puzzles.dev.nyt.net"
    ssl_sni_hostname: "puzzles.dev.nyt.net"
    healthcheck:
      host: "phoenix.games.dev.nyt.net"
      path: "/healthz"
      check_interval: "10000"
      expected_response: "200"
      initial: "5"
      threshold: "3"
      timeout: "10000"
      window: "5"

  - name: "intl_gcp"
    address: "intl.stg.nytimes.com"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "10000"
    ssl_cert_hostname: "intl.stg.nytimes.com"
    ssl_sni_hostname: "intl.stg.nytimes.com"
    healthcheck:
      host: "intl.stg.nytimes.com"
      path: "/healthcheck.php"
      check_interval: "30000"
      expected_response: "200"
      initial: "5"
      threshold: "4"
      timeout: "10000"
      window: "5"

  - name: "misc_fe"
    address: "nyt5-app-misc.stg.oma1.nyt.net"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "30000"
    ssl_cert_hostname: "nyt5-app-misc.stg.oma1.nyt.net"
    ssl_sni_hostname: "nyt5-app-misc.stg.oma1.nyt.net"
    healthcheck:
      host: "nyt5-app-misc.stg.oma1.nyt.net"
      path: "/.status"
      check_interval: "20000"
      expected_response: "200"
      initial: "4"
      threshold: "4"
      timeout: "5000"
      window: "5"

  - name: "newsdev_cloud_functions_us_central1"
    address: "us-central1-nytint-stg.cloudfunctions.net"
    between_bytes_timeout: "300000"
    connect_timeout: "300000"
    first_byte_timeout: "300000"
    ssl_cert_hostname: "us-central1-nytint-stg.cloudfunctions.net"
    ssl_sni_hostname: "us-central1-nytint-stg.cloudfunctions.net"
    healthcheck:
      host: "us-central1-nytint-stg.cloudfunctions.net"
      path: "/healthcheck"
      check_interval: "60000"
      expected_response: "200"
      initial: "4"
      threshold: "4"
      timeout: "10000"
      window: "5"

  - name: "newsdev_elections"
    address: "storage.googleapis.com"
    between_bytes_timeout: "5000"
    connect_timeout: "5000"
    first_byte_timeout: "5000"
    ssl_cert_hostname: "storage.googleapis.com"
    ssl_sni_hostname: "storage.googleapis.com"
    healthcheck:
      host: "nytint-stg-elections.storage.googleapis.com"
      path: "/healthcheck.txt"
      check_interval: "5000"
      expected_response: "200"
      initial: "5"
      threshold: "3"
      timeout: "2000"
      window: "5"

  - name: "newsdev_elections_s3"
    address: "s3.amazonaws.com"
    between_bytes_timeout: "5000"
    connect_timeout: "5000"
    first_byte_timeout: "5000"
    ssl_cert_hostname: "s3.amazonaws.com"
    ssl_sni_hostname: "s3.amazonaws.com"
    healthcheck:
      host: "nytint-stg-elections.s3.amazonaws.com"
      path: "/healthcheck.txt"
      check_interval: "5000"
      expected_response: "200"
      initial: "5"
      threshold: "3"
      timeout: "2000"
      window: "5"

  - name: "newsdev_gcs"
    address: "storage.googleapis.com"
    between_bytes_timeout: "5000"
    connect_timeout: "5000"
    first_byte_timeout: "5000"
    ssl_cert_hostname: "storage.googleapis.com"
    ssl_sni_hostname: "storage.googleapis.com"
    healthcheck:
      host: "nytint-stg-www.storage.googleapis.com"
      path: "/healthcheck.txt"
      check_interval: "5000"
      expected_response: "200"
      initial: "5"
      threshold: "3"
      timeout: "2000"
      window: "5"

  - name: "newsdev_k8s_gke"
    address: "gke.stg.newsdev.nytimes.com"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "10000"
    ssl_cert_hostname: "gke.stg.newsdev.nytimes.com"
    ssl_sni_hostname: "gke.stg.newsdev.nytimes.com"
    healthcheck:
      host: "gke.stg.newsdev.nytimes.com"
      path: "/healthz"
      check_interval: "30000"
      expected_response: "200"
      initial: "5"
      threshold: "4"
      timeout: "10000"
      window: "5"

  - name: "paidpost_fe"
    address: "nyt5-app-paidpost.stg.oma1.nyt.net"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "30000"
    ssl_cert_hostname: "nyt5-app-paidpost.stg.oma1.nyt.net"
    ssl_sni_hostname: "nyt5-app-paidpost.stg.oma1.nyt.net"
    healthcheck:
      host: "nyt5-app-paidpost.stg.oma1.nyt.net"
      path: "/.status"
      check_interval: "20000"
      expected_response: "200"
      initial: "4"
      threshold: "3"
      timeout: "5000"
      window: "4"

  - name: "programs_svc"
    address: "ftu-dot-nyt-betaprog-dev.appspot.com"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "10000"
    ssl_cert_hostname: "ftu-dot-nyt-betaprog-dev.appspot.com"
    ssl_sni_hostname: "ftu-dot-nyt-betaprog-dev.appspot.com"
    healthcheck:
      host: "ftu-dot-nyt-betaprog-dev.appspot.com"
      path: "/status.txt"
      check_interval: "5000"
      expected_response: "200"
      initial: "5"
      threshold: "3"
      timeout: "10000"
      window: "5"

  - name: "shaq_svc"
    address: "shaq-dot-nyt-betaprog-dev.appspot.com"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "10000"
    ssl_cert_hostname: "shaq-dot-nyt-betaprog-dev.appspot.com"
    ssl_sni_hostname: "shaq-dot-nyt-betaprog-dev.appspot.com"
    healthcheck:
      host: "shaq-dot-nyt-betaprog-dev.appspot.com"
      path: "/svc/shaq/v1/healthcheck"
      check_interval: "15000"
      expected_response: "200"
      initial: "5"
      threshold: "3"
      timeout: "10000"
      window: "5"

  - name: "programs_gcs"
    address: "storage.googleapis.com"
    between_bytes_timeout: "5000"
    connect_timeout: "5000"
    first_byte_timeout: "5000"
    ssl_cert_hostname: "storage.googleapis.com"
    ssl_sni_hostname: "storage.googleapis.com"
    healthcheck:
      host: "nyt-betaprog-dev-assets.storage.googleapis.com"
      path: "/healthcheck.txt"
      check_interval: "5000"
      expected_response: "200"
      initial: "5"
      threshold: "3"
      timeout: "2000"
      window: "5"

  - name: "projectvi_fe"
    address: "alpha-test.stg.nyt.net"
    between_bytes_timeout: "2000"
    connect_timeout: "3000"
    first_byte_timeout: "5000"
    ssl_cert_hostname: "alpha-test.stg.nyt.net"
    ssl_sni_hostname: "alpha-test.stg.nyt.net"
    shield: "jfk-ny-us"
    healthcheck:
      host: "alpha-test.stg.nyt.net"
      path: "/.healthcheck"
      check_interval: "20000"
      expected_response: "200"
      initial: "4"
      threshold: "3"
      timeout: "5000"
      window: "4"

  - name: "projectvi_trending_fe"
    address: "alpha-dev.dev.nyt.net"
    between_bytes_timeout: "2000"
    connect_timeout: "3000"
    first_byte_timeout: "5000"
    ssl_cert_hostname: "alpha-dev.dev.nyt.net"
    ssl_sni_hostname: "alpha-dev.dev.nyt.net"
    shield: "jfk-ny-us"
    healthcheck:
      host: "alpha-dev.dev.nyt.net"
      path: "/.healthcheck"
      check_interval: "20000"
      expected_response: "200"
      initial: "4"
      threshold: "3"
      timeout: "5000"
      window: "4"

  - name: "mwcm"
    address: "mwcm-pub.stg.gtm.nytimes.com"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "10000"
    port: "443"
    use_ssl: "true"
    ssl_check_cert: "true"
    ssl_cert_hostname: "mwcm-pub.stg.nytimes.com"
    ssl_sni_hostname: "mwcm-pub.stg.nytimes.com"
    healthcheck:
      host: "mwcm-pub.stg.gtm.nytimes.com"
      path: "/.status"
      check_interval: "5000"
      expected_response: "200"
      initial: "4"
      threshold: "3"
      timeout: "3000"
      window: "4"

  - name: "amp"
    address: "amp-dot-nyt-wfvi-dev.appspot.com"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "30000"
    ssl_cert_hostname: "amp-dot-nyt-wfvi-dev.appspot.com"
    ssl_sni_hostname: "amp-dot-nyt-wfvi-dev.appspot.com"
    healthcheck:
      host: "amp-dot-nyt-wfvi-dev.appspot.com"
      path: "/.info"
      check_interval: "20000"
      expected_response: "200"
      initial: "4"
      threshold: "3"
      timeout: "5000"
      window: "4"

  - name: "realestate_fe"
    address: "nyt5-app-realestate.stg.oma1.nyt.net"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "30000"
    ssl_cert_hostname: "nyt5-app-realestate.stg.oma1.nyt.net"
    ssl_sni_hostname: "nyt5-app-realestate.stg.oma1.nyt.net"
    healthcheck:
      host: "nyt5-app-realestate.stg.oma1.nyt.net"
      path: "/.status"
      check_interval: "20000"
      expected_response: "200"
      initial: "3"
      threshold: "3"
      timeout: "5000"
      window: "4"

  - name: "sitemap"
    address: "search.ec2.nytimes.com.s3.amazonaws.com"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "10000"
    port: "80"
    use_ssl: "false"
    healthcheck:
      host: "search.ec2.nytimes.com.s3.amazonaws.com"
      path: "/stg/mars/pub/status.txt"
      check_interval: "10000"
      expected_response: "200"
      initial: "5"
      threshold: "3"
      timeout: "10000"
      window: "5"

  - name: "tbooks"
    address: "nytinsider.wordpress.com"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "10000"
    ssl_cert_hostname: "nytinsider.wordpress.com"
    ssl_sni_hostname: "nytinsider.wordpress.com"
    healthcheck:
      host: "nytinsider.wordpress.com"
      path: "/osd.xml"
      check_interval: "60000"
      expected_response: "200"
      initial: "64"
      threshold: "1"
      timeout: "10000"
      window: "64"

  - name: "times_journeys"
    address: "timesjourneys.nytimes.com"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "10000"
    ssl_cert_hostname: "timesjourneys.nytimes.com"
    ssl_sni_hostname: "timesjourneys.nytimes.com"
    healthcheck:
      host: "timesjourneys.nytimes.com"
      path: "/osd.xml"
      check_interval: "60000"
      expected_response: "200"
      initial: "64"
      threshold: "1"
      timeout: "10000"
      window: "64"

  - name: "times_journeys_students"
    address: "timesjourneysstudents.nytimes.com"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "10000"
    ssl_cert_hostname: "timesjourneysstudents.nytimes.com"
    ssl_sni_hostname: "timesjourneysstudents.nytimes.com"
    healthcheck:
      host: "timesjourneysstudents.nytimes.com"
      path: "/osd.xml"
      check_interval: "60000"
      expected_response: "200"
      initial: "64"
      threshold: "1"
      timeout: "10000"
      window: "64"

  - name: "vp"
    address: "vp.nyt.com"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "10000"
    ssl_cert_hostname: "vp.nyt.com"
    ssl_sni_hostname: "vp.nyt.com"
    healthcheck:
      host: "vp.nyt.com"
      path: "/video/360/video.min.js"
      check_interval: "20000"
      expected_response: "200"
      initial: "4"
      threshold: "3"
      timeout: "5000"
      window: "4"

  - name: "video_api"
    address: "cherry-api.stg.nyt.net"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "10000"
    ssl_cert_hostname: "cherry-api.stg.nyt.net"
    ssl_sni_hostname: "cherry-api.stg.nyt.net"
    shield: "mdw-il-us"
    healthcheck:
      host: "cherry-api.stg.nyt.net"
      path: "/.status"
      check_interval: "30000"
      expected_response: "200"
      initial: "10"
      threshold: "8"
      timeout: "10000"
      window: "10"

  - name: "www_legacy_gke"
    address: "wf-legacy-www.stg.oma1.nyt.net"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "30000"
    ssl_cert_hostname: "wf-legacy-www.stg.oma1.nyt.net"
    ssl_sni_hostname: "wf-legacy-www.stg.oma1.nyt.net"
    healthcheck:
      host: "wf-legacy-www.stg.oma1.nyt.net"
      path: "/.status"
      check_interval: "20000"
      expected_response: "200"
      initial: "3"
      threshold: "3"
      timeout: "5000"
      window: "4"

  - name: "video_library"
    address: "times-video.stg.nyt.net"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "10000"
    ssl_cert_hostname: "times-video.stg.nyt.net"
    ssl_sni_hostname: "times-video.stg.nyt.net"
    shield: "mdw-il-us"
    healthcheck:
      host: "times-video.stg.nyt.net"
      path: "/.status"
      check_interval: "30000"
      expected_response: "200"
      initial: "10"
      threshold: "8"
      timeout: "10000"
      window: "10"

  - name: "blogs"
    address: "blogs.stg.nyt.net"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "10000"
    ssl_cert_hostname: "blogs.stg.nyt.net"
    ssl_sni_hostname: "blogs.stg.nyt.net"
    healthcheck:
      host: "blogs.stg.nyt.net"
      path: "/healthcheck"
      check_interval: "5000"
      expected_response: "200"
      initial: "5"
      threshold: "3"
      timeout: "10000"
      window: "5"

  - name: "gcs_origin"
    address: "storage.googleapis.com"
    between_bytes_timeout: "5000"
    connect_timeout: "5000"
    first_byte_timeout: "5000"
    ssl_cert_hostname: "storage.googleapis.com"
    ssl_sni_hostname: "storage.googleapis.com"
    healthcheck:
      host: "nyt-fastly-healthcheck-0000.storage.googleapis.com"
      path: "/healthcheck.txt"
      check_interval: "5000"
      expected_response: "200"
      initial: "5"
      threshold: "3"
      timeout: "2000"
      window: "5"

  - name: "profile_fe"
    address: "profile-fe.stg.nyt.net"
    between_bytes_timeout: "5000"
    connect_timeout: "5000"
    first_byte_timeout: "5000"
    ssl_cert_hostname: "profile-fe.stg.nyt.net"
    ssl_sni_hostname: "profile-fe.stg.nyt.net"
    healthcheck:
      host: "profile-fe.stg.nyt.net"
      path: "/status.txt"
      check_interval: "10000"
      expected_response: "200"
      initial: "2"
      threshold: "3"
      timeout: "5000"
      window: "5"

  - name: "community_svc"
    address: "ugc-phpapi-pub-v1-stg-ia-38969-2-1553505918.us-east-1.elb.amazonaws.com"
    between_bytes_timeout: "5000"
    connect_timeout: "5000"
    first_byte_timeout: "30000"
    ssl_cert_hostname: "ugc-phpapi-pub-v1.stg.iad1.nyt.net"
    ssl_sni_hostname: "ugc-phpapi-pub-v1.stg.iad1.nyt.net"
    healthcheck:
      host: "www.stg.nytimes.com"
      path: "/svc/community/V3/requestHandler?cmd=GetBasicInfo"
      check_interval: "20000"
      expected_response: "200"
      initial: "5"
      threshold: "3"
      timeout: "5000"
      window: "5"

  - name: "search_suggest"
    address: "ce-suggest-stg.dv.nyt.net"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "30000"
    ssl_cert_hostname: "ce-suggest-stg.dv.nyt.net"
    ssl_sni_hostname: "ce-suggest-stg.dv.nyt.net"
    healthcheck:
      host: "ce-suggest-stg.dv.nyt.net"
      path: "/dv_esp_status"
      check_interval: "20000"
      expected_response: "200"
      initial: "3"
      threshold: "3"
      timeout: "5000"
      window: "4"

   # The configuration is same as dev since they are sharing the same public elb
  - name: "recommendations"
    address: "per-rec-page-dev-iad2-108513-2-931132799.us-east-1.elb.amazonaws.com"
    between_bytes_timeout: "5000"
    connect_timeout: "5000"
    first_byte_timeout: "5000"
    ssl_cert_hostname: "recommendations.dev.iad2.nyt.net"
    ssl_sni_hostname: "recommendations.dev.iad2.nyt.net"
    healthcheck:
      host: "per-rec-page-dev-iad2-108513-2-931132799.us-east-1.elb.amazonaws.com"
      path: "/healthcheck"
      check_interval: "10000"
      expected_response: "200"
      initial: "2"
      threshold: "3"
      timeout: "5000"
      window: "5"

  - name: "switchboard"
    address: "54.163.240.55"
    between_bytes_timeout: "10000"
    connect_timeout: "10000"
    first_byte_timeout: "30000"
    port: "80"
    use_ssl: "false"
    healthcheck:
      host: "ec2-54-163-240-55.compute-1.amazonaws.com"
      path: "/healthcheck"
      check_interval: "20000"
      expected_response: "200"
      initial: "3"
      threshold: "3"
      timeout: "5000"
      window: "4"

  - name: "messaging"
    address: "messaging-hermes-edge-st-50964-2-72819608.us-east-1.elb.amazonaws.com"
    between_bytes_timeout: "5000"
    connect_timeout: "5000"
    first_byte_timeout: "5000"
    ssl_cert_hostname: "messaging-notifications.api.stg.nytimes.com"
    ssl_sni_hostname: "messaging-notifications.api.stg.nytimes.com"
    healthcheck:
      host: "messaging-hermes-edge-st-50964-2-72819608.us-east-1.elb.amazonaws.com"
      path: "/svc/message/v1/list/global.json"
      check_interval: "10000"
      expected_response: "200"
      initial: "2"
      threshold: "3"
      timeout: "5000"
      window: "5"

# defaults for cloud storage bucket configs
# these are overridable in per bucket configs below
#   auth_key:     the dictionary key for the bucket access token
#   auth_secret:  the dictionary key for the bucket access secret
#   s3_auth_key:     the dictionary key for the s3 bucket access token
#   s3_auth_secret:  the dictionary key for the s3 bucket access secret
# if you share your bucket with DV's google accounts you can use these defaults
# dictionary name for all keys is origin_auth_keys
cloud_storage_bucket_defaults:
  gcs_auth_key: "gcs_key"
  gcs_auth_secret: "gcs_secret"
  s3_auth_key: "s3_key"
  s3_auth_key: "s3_secret"

# these configurations are to map buckets for the routes that
# use cloud storage to their respective env specific storage bucket config
# pay attention to the defaults above in the case you need to override those
# be mindful that the pagetype you use here must be used in your route for this bucket!
# bucket_provider is one of: gcs, s3
cloud_storage_buckets:
  - pagetype: "cms-static-assets"
    auth: "true"
    bucket_name: "cms-gke-stg-publish-images-storage"
    bucket_provider: "gcs"
  - pagetype: "ads-static-assets"
    auth: "true"
    bucket_name: "nyt-ads-static-assets-stg"
    bucket_provider: "gcs"
  - pagetype: "newsroom-files-gcs"
    auth: "true"
    bucket_name: "newsroom-files-dev"
    bucket_provider: "gcs"
  - pagetype: "newsgraphics-gcs"
    auth: "true"
    bucket_name: "nytint-stg-newsgraphics"
    bucket_provider: "gcs"
  - pagetype: "newsdev-gcs"
    auth: "true"
    bucket_name: "nytint-stg-www"
    bucket_provider: "gcs"
  - pagetype: "vi-assets"
    auth: "false"
    bucket_name: "vi-assets"
    bucket_provider: "gcs"
  - pagetype: "video-offsite-player"
    auth: "false"
    bucket_name: "nyt-video-stg"
    bucket_provider: "gcs"
  - pagetype: "tips-html-gcs"
    auth: "true"
    bucket_name: "nyt-tips-dev-tips-html"
    bucket_provider: "gcs"

# big query logger configuration
bigquery_log:
  name: "www-stg-bigquery"
  project_id: "nyt-fastlylogs-dev"
  dataset: "www_fastly_stg"
  table: "www_stg"
  email: "fastly-log-ingest@nyt-fastlylogs-dev.iam.gserviceaccount.com"
  template: "%Y%m%d%H"
  format: >-
    {
    \"service_id\":\"%{req.service_id}V\",
    \"time_start\":\"%{begin:%Y-%m-%dT%H:%M:%S%Z}t\",
    \"time_end\":\"%{end:%Y-%m-%dT%H:%M:%S%Z}t\",
    \"time_elapsed\":%D,
    \"client_ip\":\"%h\",
    \"client_as_name\":\"%{client.as.name}V\",
    \"client_as_number\":\"%{client.as.number}V\",
    \"client_connection_speed\":\"%{client.geo.conn_speed}V\",
    \"request\":\"%m\",
    \"protocol\":\"%H\",
    \"host\":\"%{Fastly-Orig-Host}i\",
    \"origin_host\":\"%v\",
    \"url\":\"%{cstr_escape(req.url)}V\",
    \"is_ipv6\":%{if(req.is_ipv6, \\\"true\\\", \\\"false\\\")}V,
    \"is_tls\":%{if(req.is_ssl, \\\"true\\\", \\\"false\\\")}V,
    \"tls_client_protocol\":\"%{cstr_escape(tls.client.protocol)}V\",
    \"tls_client_servername\":\"%{cstr_escape(tls.client.servername)}V\",
    \"tls_client_cipher\":\"%{cstr_escape(tls.client.cipher)}V\",
    \"tls_client_cipher_sha\":\"%{cstr_escape(tls.client.ciphers_sha)}V\",
    \"tls_client_tlsexts_sha\":\"%{cstr_escape(tls.client.tlsexts_sha)}V\",
    \"is_h2\":%{if(fastly_info.is_h2, \\\"true\\\", \\\"false\\\")}V,
    \"is_h2_push\":%{if(fastly_info.h2.is_push, \\\"true\\\", \\\"false\\\")}V,
    \"h2_stream_id\":\"%{fastly_info.h2.stream_id}V\",
    \"request_referer\":\"%{Referer}i\",
    \"request_user_agent\":\"%{User-Agent}i\",
    \"request_accept_content\":\"%{Accept}i\",
    \"request_accept_language\":\"%{Accept-Language}i\",
    \"request_accept_encoding\":\"%{Accept-Encoding}i\",
    \"request_accept_charset\":\"%{Accept-Charset}i\",
    \"request_connection\":\"%{Connection}i\",
    \"request_dnt\":\"%{DNT}i\",
    \"request_forwarded\":\"%{Forwarded}i\",
    \"request_via\":\"%{Via}i\",
    \"request_cache_control\":\"%{Cache-Control}i\",
    \"request_x_requested_with\":\"%{X-Requested-With}i\",
    \"request_x_att_device_id\":\"%{X-ATT-Device-Id}i\",
    \"request_x_forwarded_for\":\"%{X-Forwarded-For}i\",
    \"status\":\"%s\",
    \"content_type\":\"%{Content-Type}o\",
    \"cache_status\":\"%{fastly_info.state}V\",
    \"is_cacheable\":%{if(fastly_info.state ~\\\"^(HIT|MISS)$\\\", \\\"true\\\", \\\"false\\\")}V,
    \"response_age\":\"%{Age}o\",
    \"response_cache_control\":\"%{Cache-Control}o\",
    \"response_expires\":\"%{Expires}o\",
    \"response_last_modified\":\"%{Last-Modified}o\",
    \"response_tsv\":\"%{TSV}o\",
    \"server_datacenter\":\"%{server.datacenter}V\",
    \"server_ip\":\"%A\",
    \"geo_city\":\"%{client.geo.city.utf8}V\",
    \"geo_country_code\":\"%{client.geo.country_code}V\",
    \"geo_continent_code\":\"%{client.geo.continent_code}V\",
    \"geo_region\":\"%{client.geo.region}V\",
    \"req_header_size\":%{req.header_bytes_read}V,
    \"req_body_size\":%{req.body_bytes_read}V,
    \"resp_header_size\":%{resp.header_bytes_written}V,
    \"resp_body_size\":%B,
    \"socket_cwnd\":%{client.socket.cwnd}V,
    \"socket_nexthop\":\"%{client.socket.nexthop}V\",
    \"socket_tcpi_rcv_mss\":%{client.socket.tcpi_rcv_mss}V,
    \"socket_tcpi_snd_mss\":%{client.socket.tcpi_snd_mss}V,
    \"socket_tcpi_rtt\":%{client.socket.tcpi_rtt}V,
    \"socket_tcpi_rttvar\":%{client.socket.tcpi_rttvar}V,
    \"socket_tcpi_rcv_rtt\":%{client.socket.tcpi_rcv_rtt}V,
    \"socket_tcpi_rcv_space\":%{client.socket.tcpi_rcv_space}V,
    \"socket_tcpi_last_data_sent\":%{client.socket.tcpi_last_data_sent}V,
    \"socket_tcpi_total_retrans\":%{client.socket.tcpi_total_retrans}V,
    \"socket_tcpi_delta_retrans\":%{client.socket.tcpi_delta_retrans}V,
    \"socket_ploss\":%{client.socket.ploss}V,
    \"backend_name\":\"%{if(req.http.x-nyt-backend,req.http.x-nyt-backend,\\\"\\\")}V\",
    \"pagetype\":\"%{if(req.http.x-nyt-route,req.http.x-nyt-route,\\\"\\\")}V\",
    \"apiversion\":\"%{if(resp.http.X-API-Version,resp.http.X-API-Version,\\\"\\\")}V\",
    \"redirect_reason\":\"%{if(req.http.var-nyt-redirect-reason,regsub(req.http.var-nyt-redirect-reason,\\\"redir=\\\\[([^\\\\]]+)\\\\]\\\",\\\"\\\\1\\\"),\\\"\\\")}V\",
    \"trace_id\": \"%{if(req.http.x-b3-trace-id,req.http.x-b3-trace-id,\\\"\\\")}V\",
    \"backend_healthy\": \"%{if(req.http.x-nyt-backend-health,req.http.x-nyt-backend-health,\\\"\\\")}V\",
    \"restarts\": %{req.restarts}V
    }
