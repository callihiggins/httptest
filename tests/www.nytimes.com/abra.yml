tests:
  - description: Project Ocean ABRA test from Brazil on the Home route should be allocated
      and return the debug-vi-abtest header
    request:
      path: /?ip-override=187.44.210.58
      headers:
        x-nyt-miss: "1"
        project-ocean-test: "true"
        cookie: nyt-a=eb6222b5c4b843ffd255ca86f7decb8c
    conditions:
      env:
        TEST_ENV: dev|stg|prd
    response:
      headers:
        patterns:
          x-nyt-country: BR
          debug-vi-abtest: dfp_latamv2=0_control&HOME_chartbeat=0_control
  - description: Project Ocean test ABRA from Brazil on the Story route should be allocated
      and return the debug-vi-abtest header
    request:
      path: /2019/05/29/us/terrill-thomas-milwaukee-settlement.html?ip-override=187.44.210.58
      headers:
        x-nyt-miss: "1"
        project-ocean-test: "true"
        cookie: nyt-a=eb6222b5c4b843ffd255ca86f7decb8c
    conditions:
      env:
        TEST_ENV: dev|stg|prd
    response:
      headers:
        patterns:
          x-nyt-country: BR
          debug-vi-abtest: dfp_latamv2=0_control
  - description: Project Ocean test ABRA from Brazil on the Collection route should not be
      allocated and return the debug-vi-abtest header
    request:
      path: /column/36-hours?ip-override=187.44.210.58
      headers:
        x-nyt-miss: "1"
        project-ocean-test: "true"
        cookie: nyt-a=eb6222b5c4b843ffd255ca86f7decb8c
    conditions:
      env:
        TEST_ENV: dev|stg|prd
    response:
      headers:
        patterns:
          x-nyt-country: BR
          x-nyt-route: vi-collection
        notPresent:
          - debug-vi-abtest
  - description: Project Ocean ABRA test from US on the Home route should not be allocated
      and return the debug-vi-abtest header
    request:
      path: /
      headers:
        x-nyt-miss: "1"
        project-ocean-test: "true"
        cookie: nyt-a=eb6222b5c4b843ffd255ca86f7decb8c
    conditions:
      env:
        TEST_ENV: dev|stg|prd
    response:
      headers:
        patterns:
          x-nyt-country: US
          debug-vi-abtest: HOME_chartbeat=0_control
  - description: Project Ocean test ABRA from US on the Story route should not be allocated
      and return the debug-vi-abtest header
    request:
      path: /2019/05/29/us/terrill-thomas-milwaukee-settlement.html
      headers:
        x-nyt-miss: "1"
        project-ocean-test: "true"
        cookie: nyt-a=eb6222b5c4b843ffd255ca86f7decb8c
    conditions:
      env:
        TEST_ENV: dev|stg|prd
    response:
      headers:
        patterns:
          x-nyt-country: US
        notPresent:
          - debug-vi-abtest
  - description: HOME Chartbeat test ABRA on the Home route should be allocated
      to 0_control and return the debug-vi-abtest header
    request:
      path: /
      headers:
        x-nyt-miss: "1"
        cookie: nyt-a=U_BHVjUVAkvVObRSkkPagz
    conditions:
      env:
        TEST_ENV: dev|stg|prd
    response:
      headers:
        patterns:
          debug-vi-abtest: HOME_chartbeat=0_control
  - description: HOME Chartbeat test ABRA on the Home route should be allocated
      to 1_variant and return the debug-vi-abtest header
    request:
      path: /
      headers:
        x-nyt-miss: "1"
        cookie: nyt-a=xG724KOYMP3uFSGpPrAzgE
    conditions:
      env:
        TEST_ENV: dev|stg|prd
    response:
      headers:
        patterns:
          debug-vi-abtest: HOME_chartbeat=1_variant
  - description: HOME Chartbeat test ABRA on the Story route should not be allocated
      and return the debug-vi-abtest header
    request:
      path: /2019/05/29/us/terrill-thomas-milwaukee-settlement.html
      headers:
        x-nyt-miss: "1"
        cookie: nyt-a=eb6222b5c4b843ffd255ca86f7decb8c
    conditions:
      env:
        TEST_ENV: dev|stg|prd
    response:
      headers:
        notPresent:
          - debug-vi-abtest
  - description: Storylines test ABRA on the Story route returns the debug-vi-abtest header
    request:
      path: /2019/08/01/us/warroad-pioneer-news-desert.html
      headers:
        x-nyt-miss: "1"
        storylines-recirc-test: "true"
        cookie: nyt-a=eb6222b5c4b843ffd255ca86f7decb8c
    conditions:
      env:
        TEST_ENV: dev|stg|prd
    response:
      headers:
        patterns:
          debug-vi-abtest: ^STYLN_recirc_pres=0_recirc_pres_control$
  - description: Storylines test ABRA on the Story route does not return debug-vi-abtest header when false
    request:
      path: /2019/08/01/us/warroad-pioneer-news-desert.html
      headers:
        x-nyt-miss: "1"
        storylines-recirc-test: "false"
        cookie: nyt-a=eb6222b5c4b843ffd255ca86f7decb8c
    conditions:
      env:
        TEST_ENV: dev|stg|prd
    response:
      headers:
        patterns:
          x-nyt-country: US
        notPresent:
          - debug-vi-abtest
  - description: Storylines test ABRA on the a collections route does not return the debug-vi-abtest header
    request:
      path: /column/36-hours
      headers:
        x-nyt-miss: "1"
        storylines-recirc-test: "true"
        cookie: nyt-a=eb6222b5c4b843ffd255ca86f7decb8c
    conditions:
      env:
        TEST_ENV: dev|stg|prd
    response:
      headers:
        patterns:
          x-nyt-route: vi-collection
        notPresent:
          - debug-vi-abtest
  - description: Storylines test ABRA does not return a header when before 08/01/2019
    request:
      path: /2019/05/29/us/terrill-thomas-milwaukee-settlement.html
      headers:
        x-nyt-miss: "1"
        storylines-recirc-test: "true"
        cookie: nyt-a=eb6222b5c4b843ffd255ca86f7decb8c
    conditions:
      env:
        TEST_ENV: dev|stg|prd
    response:
      headers:
        patterns:
          x-nyt-country: US
        notPresent:
          - debug-vi-abtest
  - description: Project Ocean ABRA test and Storylines ABRA test concatenate 
    request:
      path: /2019/08/01/us/warroad-pioneer-news-desert.html?ip-override=187.44.210.58
      headers:
        x-nyt-miss: "1"
        project-ocean-test: "true"
        storylines-recirc-test: "true"
        cookie: nyt-a=eb6222b5c4b843ffd255ca86f7decb8c
    conditions:
      env:
        TEST_ENV: dev|stg|prd
    response:
      headers:
        patterns:
          x-nyt-country: BR
          debug-vi-abtest: dfp_latamv2=0_control&STYLN_recirc_pres=0_recirc_pres_control
  - description: Project Ocean test ABRA from US on the Story route should not be allocated
      and Storylines test should not be allocated before 8/01
    request:
      path: /2019/05/29/us/terrill-thomas-milwaukee-settlement.html
      headers:
        x-nyt-miss: "1"
        project-ocean-test: "true"
        cookie: nyt-a=eb6222b5c4b843ffd255ca86f7decb8c
    conditions:
      env:
        TEST_ENV: dev|stg|prd
    response:
      headers:
        patterns:
          x-nyt-country: US
        notPresent:
          - debug-vi-abtest
